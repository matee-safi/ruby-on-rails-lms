<%= simple_form_for(blog) do |f| %>

  <div class="mt-4">
    <%= render 'shared/error_messages', object: blog, locals: { class: "mt-4" } %>
  </div>

  <div class="my-5">
    <%= f.label :title %>
    <%= f.text_field :title, class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full" %>
  </div>

  <div class="my-5">
    <%= f.label :content %>
    <%= f.text_area :content, rows: 4, class: "block shadow rounded-md border border-gray-200 outline-none px-3 py-2 mt-2 w-full" %>
  </div>

  <div data-controller="blog-image-preview" id="image-preview" class="my-5">
    <%= f.label :title_image %> (Optional but recommended)
    <div class="join w-full">
      <%= f.file_field :title_image,
        direct_upload: true,
        data: { blog_image_preview_target: "input", action: "change->blog-image-preview#preview" },
        class: "join-item file-input file-input-bordered file-input-primary mt-2 w-full"
      %>
      <%= button_tag "Remove Image", data: { action: "click->blog-image-preview#removeImage" }, type: "button", class: "join-item btn btn-error mt-2 bg-[#EF4D57] dark:bg-[#EF4E5C]", onclick: "setRemove()" %>
    </div>
    <% if blog.title_image.attached? %>
      <%= link_to "Remove Image", blog_title_image_path(blog), data: { turbo_method: :delete }, class: "hidden", id: "remove-image-link" %>
      <%= image_tag blog.title_image, data: { blog_image_preview_target: "preview" }, class: "w-full h-full object-cover rounded-lg mt-2" %>
    <% else %>
      <%= image_tag "https://www.eventbrite.com/engineering/wp-content/uploads/engineering/2018/08/Flexible-Reusable-React-File-Uploader.png", data: { blog_image_preview_target: "preview" }, class: "w-full h-full object-cover rounded-lg mt-2" %>
    <% end %>
  </div>

  <div class="flex gap-5 justify-end">
    <% if blog.persisted? %>
      <%= link_to "Cancel", blog_path(blog), class: "btn" %>
    <% else %>
      <%= link_to "Cancel", blogs_path, class: "btn" %>
    <% end %>
    <%= f.submit class: "btn btn-primary", onclick: "submitForm()" %>
  </div>

  <script defer>
    const setRemove = () => {
      document.getElementById("image-preview").classList.add("delete");
    }

    const submitForm = () => {
      event.preventDefault();
      const removeImage = document.getElementById("image-preview");
      const removeBtn = document.getElementById("remove-image-link");
      if (removeImage.classList.contains("delete") && removeBtn) {
        removeBtn.click();
        event.target.form.submit();
      } else {
        event.target.form.submit();
      }
    }
  </script>

<% end %>
